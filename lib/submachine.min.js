(function(){var t,n,e=[].slice,o={}.hasOwnProperty,r=function(t,n){function e(){this.constructor=t}for(var r in n)o.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},i=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};t=function(){function t(t){null!=t&&this.initState(t)}var n,o;return o=Array.isArray||function(t){return"[object Array]"==={}.toString.apply(t)},n=function(t){var e,o;if(null==t||"object"!=typeof t)return t;e=new t.constructor;for(o in t)e[o]=n(t[o]);return e},t.hasStates=function(){var t;return t=arguments.length>=1?e.call(arguments,0):[],this.prototype._states=o(t[0])?t[0]:t},t.transition=function(t){var o,r,i,a,l,s,u,c;if(null==t||null==t.from||null==t.to||null==t.on)throw Error("transition must define 'from', 'to' and 'on'");return null==(s=(o=this.prototype)._events)&&(o._events={}),this.prototype.hasOwnProperty("_events")||(this.prototype._events=n(this.prototype._events)),null==(u=(r=this.prototype._events)[a=t.on])&&(r[a]=[]),this.prototype._events[t.on].push({from:t.from,to:t.to}),null!=(c=(i=this.prototype)[l=t.on])?c:i[l]=function(){var n,o,r,i,a,l;for(n=arguments.length>=1?e.call(arguments,0):[],a=this._events[t.on],l=[],r=0,i=a.length;i>r;r++){if(o=a[r],this.state===o.from||"*"===o.from){this.switchTo.apply(this,[o.to].concat(e.call(n)));break}l.push(void 0)}return l}},t._addStateCallback=function(t,e,o){var r,i,a,l,s,u;return null==(l=(r=this.prototype)._callbacks)&&(r._callbacks={}),this.prototype.hasOwnProperty("_callbacks")||(this.prototype._callbacks=n(this.prototype._callbacks)),null==(s=(i=this.prototype._callbacks)[t])&&(i[t]={}),null==(u=(a=this.prototype._callbacks[t])[e])&&(a[e]=[]),this.prototype._callbacks[t][e].push(o)},t.onEnter=function(t,n){return this._addStateCallback(t,"onEnter",n)},t.onLeave=function(t,n){return this._addStateCallback(t,"onLeave",n)},t.setupState=function(t,n){return null==n&&(n={}),null!=n.onEnter&&this.onEnter(t,n.onEnter),null!=n.onLeave?this.onLeave(t,n.onLeave):void 0},t.subclass=function(t){var n;return n=function(t){function n(){var t;t=arguments.length>=1?e.call(arguments,0):[],null!=this.initialize?this.initialize.apply(this,t):n.__super__.constructor.apply(this,t)}return r(n,t),n}(this),null!=t&&t.call(n,n.prototype),n},t.prototype.initState=function(t){if(null!=this.state)throw Error("state was already initialized");return this.switchTo(t)},t.prototype.switchTo=function(){var t,n;if(n=arguments[0],t=arguments.length>=2?e.call(arguments,1):[],0>i.call(this._states,n))throw Error("invalid state "+n);return null!=this.state&&this._invokeStateCallbacks(this.state,"onLeave",t),this.state=n,this._invokeStateCallbacks(this.state,"onEnter",t)},t.prototype._invokeStateCallbacks=function(t,n,e){var o,r,i,a,l,s,u;for("*"!==t&&this._invokeStateCallbacks("*",n,e),s=(null!=(a=this._callbacks)?null!=(l=a[t])?l[n]:void 0:void 0)||[],u=[],r=0,i=s.length;i>r;r++)o=s[r],u.push(o.apply(this,e));return u},t}(),n!==void 0&&null!==n?("undefined"!=typeof module&&null!==module&&null!=module.exports&&(n=module.exports=t),n.Submachine=t):"function"==typeof define&&define.amd?define(function(){return t}):this.Submachine=t}).call(this);