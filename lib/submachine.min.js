(function(){var t,n,e=[].slice,l=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};t=function(){function t(t){null!=t&&this.initState(t)}var n,o;return o=Array.isArray||function(t){return"[object Array]"==={}.toString.apply(t)},n=function(t){var e,l;if(null==t||"object"!=typeof t)return t;e=new t.constructor;for(l in t)e[l]=n(t[l]);return e},t.hasStates=function(){var t;return t=arguments.length>=1?e.call(arguments,0):[],this.prototype.states=o(t[0])?t[0]:t},t.transition=function(t){var l,o,r,i,a,s,u,c;if(null==t||null==t.from||null==t.to||null==t.on)throw Error("transition must define 'from', 'to' and 'on'");return null==(s=(l=this.prototype).events)&&(l.events={}),this.prototype.hasOwnProperty("events")||(this.prototype.events=n(this.prototype.events)),null==(u=(o=this.prototype.events)[i=t.on])&&(o[i]=[]),this.prototype.events[t.on].push({from:t.from,to:t.to}),null!=(c=(r=this.prototype)[a=t.on])?c:r[a]=function(){var n,l,o,r,i,a;for(n=arguments.length>=1?e.call(arguments,0):[],i=this.events[t.on],a=[],o=0,r=i.length;r>o;o++){if(l=i[o],this.state===l.from||"*"===l.from){this.switchTo.apply(this,[l.to].concat(e.call(n)));break}a.push(void 0)}return a}},t._addStateCallback=function(t,e,l){var o,r,i,a;return null==(i=(o=this.prototype).callbacks)&&(o.callbacks={}),this.prototype.hasOwnProperty("callbacks")||(this.prototype.callbacks=n(this.prototype.callbacks)),null==(a=(r=this.prototype.callbacks)[t])&&(r[t]={}),this.prototype.callbacks[t][e]=l},t.onEnter=function(t,n){return this._addStateCallback(t,"onEnter",n)},t.onLeave=function(t,n){return this._addStateCallback(t,"onLeave",n)},t.setupState=function(t,n){return null==n&&(n={}),null!=n.onEnter&&this.onEnter(t,n.onEnter),null!=n.onLeave?this.onLeave(t,n.onLeave):void 0},t.subclass=function(t){var n,l,o,r;n=this,o=function(){var t;return t=arguments.length>=1?e.call(arguments,0):[],null!=this.initialize?this.initialize.apply(this,t):n.apply(this,t)};for(l in n)r=n[l],o[l]=r;return o.prototype=new n,o.prototype.constructor=o,null!=t&&t.call(o,o.prototype),o},t.prototype.initState=function(t){if(null!=this.state)throw Error("state was already initialized");return this.switchTo(t)},t.prototype.switchTo=function(){var t,n,o,r,i,a,s,u,c,h,p;if(n=arguments[0],t=arguments.length>=2?e.call(arguments,1):[],0>l.call(this.states,n))throw Error("invalid state "+n);return null==(o=this.callbacks)&&(this.callbacks={}),null!=this.state&&(null!=(r=this.callbacks[this.state])&&null!=(i=r.onLeave)&&i.apply(this,t),null!=(a=this.callbacks["*"])&&null!=(s=a.onLeave)&&s.apply(this,t)),this.state=n,null!=(u=this.callbacks[this.state])&&null!=(c=u.onEnter)&&c.apply(this,t),null!=(h=this.callbacks["*"])?null!=(p=h.onEnter)?p.apply(this,t):void 0:void 0},t}(),n!==void 0&&null!==n?("undefined"!=typeof module&&null!==module&&null!=module.exports&&(n=module.exports=t),n.Submachine=t):"function"==typeof define&&define.amd?define(function(){return t}):this.Submachine=t}).call(this);